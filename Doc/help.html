<!DOCTYPE html>
<html>
<head>
  <title>Asterisk Call Actions Settings</title>
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>


<h1>Notes</h1>
<p>It's up to the user to implement the required server-side scripts "get_calls" and "action", including how user and password variables are utilised.</p>
<p>The settings option "URL" doesn't require a trailing slash (it will be removed on save if present).</p>

<p>mod_rewrite or similar can be used to point /get_calls and /action to the relevant scripts, allowing for freedom of scripting language.</p>
<p>An example for PHP:<pre>
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L,QSA]
</pre></p>


<h2>get_calls</h2>

<p>The server needs to provide a well-formed JSON response from "/get_calls", with the option values of "Extension" and "Password" sent as POST parameters "ext" and "pass" respectively.</p>
<p>The response should contain two arrays, "calls_curr" and "calls_hist", each containing zero or more call objects.</p>
<p>Call objects should contain four strings:</p>

<ul>
  <li>cid &mdash; the caller's ID if available/recognised, or any code in brackets (cids starting "(" are displayed in a lighter colour for visual differentiation)</li>
  <li>number &mdash; external phone number, or an empty string if unavailable</li>
  <li>start &mdash; timestamp of the start of the call</li>
  <li>end &mdash; timestamp of the end of the call, or an empty string if the call is ongoing</li>
</ul>

<p>Sample JSON response:<pre>
{

"calls_curr" : [

{
   "cid": "J South",
"number": "02075678910",
 "start": "1436456013",
   "end": ""
}

],


"calls_hist" : [

{
   "cid": "O Bowden",
"number": "0207567811",
 "start": "1436455513",
   "end": "1436455613"
},

{
   "cid": "(Unmatched)",
"number": "02075042351",
 "start": "1436446013",
   "end": "1436446313"
},

{
   "cid": "(Anonymous)",
"number": "",
 "start": "1436445913",
   "end": "1436446013"
}

] }

</pre></p>

<h2>action</h2>
<p>On clicking any listed call, a new tab is opened with the url "\action?number=XXXXXXXX" (with XXXXX being the external number of the clicked call).</p>
<p>The simplest use-case would be a redirect to a CRM using the supplied "number" as a query-string variable.</p>




</body>
</html>